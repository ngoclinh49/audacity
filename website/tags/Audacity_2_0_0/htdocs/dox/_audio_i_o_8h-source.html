<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Audacity: AudioIO.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_adfc63277209eec55cb7e0afee0e8d0e.html">src</a>
  </div>
</div>
<div class="contents">
<h1>AudioIO.h</h1><a href="_audio_i_o_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  Audacity: A Digital Audio Editor</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">  AudioIO.h</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">  Dominic Mazzoni</span>
<a name="l00008"></a>00008 <span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment">  Use the PortAudio library to play and record sound</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">**********************************************************************/</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#ifndef __AUDACITY_AUDIO_IO__</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor">#define __AUDACITY_AUDIO_IO__</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "portaudio.h"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="_audacity_8h.html">Audacity.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="_experimental_8h.html">Experimental.h</a>"</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#ifdef USE_MIDI</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#ifdef EXPERIMENTAL_MIDI_OUT</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#include "portmidi.h"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "porttime.h"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#endif // EXPERIMENTAL_MIDI_OUT</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#include "allegro.h"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#endif // USE_MIDI</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span>
<a name="l00028"></a>00028 <span class="preprocessor">#if USE_PORTMIXER</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#include "portmixer.h"</span>
<a name="l00030"></a>00030 <span class="preprocessor">#endif</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;wx/string.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;wx/thread.h&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include "<a class="code" href="_wave_track_8h.html">WaveTrack.h</a>"</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include "<a class="code" href="_sample_format_8h.html">SampleFormat.h</a>"</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="keyword">class </span><a class="code" href="class_audio_i_o.html" title="AudioIO uses the PortAudio library to play and record sound.">AudioIO</a>;
<a name="l00039"></a>00039 <span class="keyword">class </span><a class="code" href="class_ring_buffer.html" title="Holds streamed audio samples.">RingBuffer</a>;
<a name="l00040"></a>00040 <span class="keyword">class </span><a class="code" href="class_mixer.html" title="Functions for doing the mixdown of the tracks.">Mixer</a>;
<a name="l00041"></a>00041 <span class="keyword">class </span><a class="code" href="class_resample.html" title="Combined interface to libresample and libsamplerate.">Resample</a>;
<a name="l00042"></a>00042 <span class="keyword">class </span><a class="code" href="class_time_track.html" title="A kind of Track used to &amp;#39;warp time&amp;#39;.">TimeTrack</a>;
<a name="l00043"></a>00043 <span class="keyword">class </span><a class="code" href="class_audio_thread.html" title="Defined different on Mac and other platforms (on Mac it does not use wxWidgets wxThread)...">AudioThread</a>;
<a name="l00044"></a>00044 <span class="keyword">class </span><a class="code" href="class_meter.html" title="VU Meter, for displaying recording/playback level.">Meter</a>;
<a name="l00045"></a>00045 <span class="keyword">class </span><a class="code" href="class_time_track.html" title="A kind of Track used to &amp;#39;warp time&amp;#39;.">TimeTrack</a>;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">extern</span> AUDACITY_DLL_API <a class="code" href="class_audio_i_o.html" title="AudioIO uses the PortAudio library to play and record sound.">AudioIO</a> *<a class="code" href="_audio_i_o_8cpp.html#142d4fde5f1429059adcac9ea1f63425">gAudioIO</a>;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="keywordtype">void</span> <a class="code" href="_audio_i_o_8cpp.html#5c082d9ef3612f42a4a78edffdf2a0db">InitAudioIO</a>();
<a name="l00050"></a>00050 <span class="keywordtype">void</span> <a class="code" href="_audio_i_o_8cpp.html#362633315924afe19ab0fe0cf4bd32da">DeinitAudioIO</a>();
<a name="l00051"></a>00051 wxString <a class="code" href="_audio_i_o_8cpp.html#289724ea943616e20d183ab0e6481bf7">DeviceName</a>(<span class="keyword">const</span> PaDeviceInfo* info);
<a name="l00052"></a>00052 <span class="keywordtype">bool</span> <a class="code" href="_audio_i_o_8h.html#52869f87b7f433c8848a4f2e90f31dfc">ValidateDeviceNames</a>();
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="class_audio_i_o_listener.html">00054</a> <span class="keyword">class </span>AUDACITY_DLL_API <a class="code" href="class_audio_i_o_listener.html">AudioIOListener</a> {
<a name="l00055"></a>00055 <span class="keyword">public</span>:
<a name="l00056"></a><a class="code" href="class_audio_i_o_listener.html#bd124e6ac835f2ddb8dbc036e469185b">00056</a>    <a class="code" href="class_audio_i_o_listener.html#bd124e6ac835f2ddb8dbc036e469185b">AudioIOListener</a>() {}
<a name="l00057"></a><a class="code" href="class_audio_i_o_listener.html#d33d9783bd3ad9236615199759e244fb">00057</a>    <span class="keyword">virtual</span> <a class="code" href="class_audio_i_o_listener.html#d33d9783bd3ad9236615199759e244fb">~AudioIOListener</a>() {}
<a name="l00058"></a>00058    
<a name="l00059"></a>00059    <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnAudioIORate(<span class="keywordtype">int</span> rate) = 0;
<a name="l00060"></a>00060    <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnAudioIOStartRecording() = 0;
<a name="l00061"></a>00061    <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnAudioIOStopRecording() = 0;
<a name="l00062"></a>00062    <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnAudioIONewBlockFiles(<span class="keyword">const</span> wxString&amp; blockFileLog) = 0;
<a name="l00063"></a>00063 };
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="_audio_i_o_8h.html#255835246ff122feb234d863682ddc2e">00065</a> <span class="preprocessor">#define MAX_MIDI_BUFFER_SIZE 5000</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>
<a name="l00067"></a><a class="code" href="_audio_i_o_8h.html#06b8265d96a5807edc5e5ef55a7447c6">00067</a> <span class="preprocessor">#define DEFAULT_LATENCY_DURATION 100.0</span>
<a name="l00068"></a><a class="code" href="_audio_i_o_8h.html#cf41a5bce3221873d14013c473e45326">00068</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_LATENCY_CORRECTION -130.0</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00070"></a>00070 <span class="preprocessor">#ifdef AUTOMATED_INPUT_LEVEL_ADJUSTMENT</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">   #define AILA_DEF_TARGET_PEAK 92</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">   #define AILA_DEF_DELTA_PEAK 2</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">   #define AILA_DEF_ANALYSIS_TIME 1000</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">   #define AILA_DEF_NUMBER_ANALYSIS 5</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00077"></a><a class="code" href="class_audio_i_o.html">00077</a> <span class="keyword">class </span>AUDACITY_DLL_API <a class="code" href="class_audio_i_o.html" title="AudioIO uses the PortAudio library to play and record sound.">AudioIO</a> {
<a name="l00078"></a>00078 
<a name="l00079"></a>00079  <span class="keyword">public</span>:
<a name="l00080"></a>00080    <a class="code" href="class_audio_i_o.html" title="AudioIO uses the PortAudio library to play and record sound.">AudioIO</a>();
<a name="l00081"></a>00081    ~<a class="code" href="class_audio_i_o.html" title="AudioIO uses the PortAudio library to play and record sound.">AudioIO</a>();
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="class_audio_i_o.html#78477917ca8c9800ce6f5074a7044399">00083</a>    <a class="code" href="class_audio_i_o_listener.html">AudioIOListener</a>* <a class="code" href="class_audio_i_o.html#78477917ca8c9800ce6f5074a7044399">GetListener</a>() { <span class="keywordflow">return</span> mListener; }
<a name="l00084"></a>00084    <span class="keywordtype">void</span> SetListener(<a class="code" href="class_audio_i_o_listener.html">AudioIOListener</a>* listener);
<a name="l00085"></a>00085    
<a name="l00093"></a>00093    <span class="keywordtype">void</span> StartMonitoring(<span class="keywordtype">double</span> sampleRate);
<a name="l00094"></a>00094 
<a name="l00102"></a>00102    <span class="keywordtype">int</span> StartStream(WaveTrackArray playbackTracks, WaveTrackArray captureTracks,
<a name="l00103"></a>00103 #ifdef EXPERIMENTAL_MIDI_OUT
<a name="l00104"></a>00104                    NoteTrackArray *midiTracks,
<a name="l00105"></a>00105 #endif
<a name="l00106"></a>00106                    <a class="code" href="class_time_track.html" title="A kind of Track used to &amp;#39;warp time&amp;#39;.">TimeTrack</a> *timeTrack, <span class="keywordtype">double</span> sampleRate,
<a name="l00107"></a>00107                    <span class="keywordtype">double</span> t0, <span class="keywordtype">double</span> t1,
<a name="l00108"></a>00108                    <a class="code" href="class_audio_i_o_listener.html">AudioIOListener</a>* listener,
<a name="l00109"></a>00109                    <span class="keywordtype">bool</span> playLooped = <span class="keyword">false</span>,
<a name="l00110"></a>00110                    <span class="keywordtype">double</span> cutPreviewGapStart = 0.0,
<a name="l00111"></a>00111                    <span class="keywordtype">double</span> cutPreviewGapLen = 0.0);
<a name="l00112"></a>00112 
<a name="l00118"></a>00118    <span class="keywordtype">void</span> StopStream();
<a name="l00121"></a><a class="code" href="class_audio_i_o.html#40488ff8506e6238963049844728a6c6">00121</a>    <span class="keywordtype">void</span> <a class="code" href="class_audio_i_o.html#40488ff8506e6238963049844728a6c6" title="Move the playback / recording position of the current stream by the specified amount...">SeekStream</a>(<span class="keywordtype">double</span> seconds) { mSeek = seconds; };
<a name="l00122"></a>00122    
<a name="l00127"></a>00127    <span class="keywordtype">bool</span> IsBusy();
<a name="l00128"></a>00128 
<a name="l00135"></a>00135    <span class="keywordtype">bool</span> IsStreamActive();
<a name="l00136"></a>00136    <span class="keywordtype">bool</span> IsStreamActive(<span class="keywordtype">int</span> token);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="preprocessor">#ifdef EXPERIMENTAL_MIDI_OUT</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>
<a name="l00141"></a>00141    <span class="keywordtype">bool</span> IsMidiActive(); <span class="comment">// </span>
<a name="l00142"></a>00142 <span class="preprocessor">#endif</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>
<a name="l00149"></a>00149    <span class="keywordtype">bool</span> IsAudioTokenActive(<span class="keywordtype">int</span> token);
<a name="l00150"></a>00150 
<a name="l00153"></a>00153    <span class="keywordtype">bool</span> IsMonitoring();
<a name="l00154"></a>00154 
<a name="l00156"></a>00156    <span class="keywordtype">void</span> SetPaused(<span class="keywordtype">bool</span> state);
<a name="l00158"></a>00158    <span class="keywordtype">bool</span> IsPaused();
<a name="l00159"></a>00159 
<a name="l00160"></a>00160    <span class="comment">/* Mixer services are always available.  If no stream is running, these</span>
<a name="l00161"></a>00161 <span class="comment">    * methods use whatever device is specified by the preferences.  If a</span>
<a name="l00162"></a>00162 <span class="comment">    * stream *is* running, naturally they manipulate the mixer associated</span>
<a name="l00163"></a>00163 <span class="comment">    * with that stream.  If no mixer is available, output is emulated and </span>
<a name="l00164"></a>00164 <span class="comment">    * input is stuck at 1.0f (a gain is applied to output samples).</span>
<a name="l00165"></a>00165 <span class="comment">    */</span>
<a name="l00166"></a>00166    <span class="keywordtype">void</span> SetMixer(<span class="keywordtype">int</span> inputSource, <span class="keywordtype">float</span> inputVolume,
<a name="l00167"></a>00167                  <span class="keywordtype">float</span> playbackVolume);
<a name="l00168"></a>00168    <span class="keywordtype">void</span> GetMixer(<span class="keywordtype">int</span> *inputSource, <span class="keywordtype">float</span> *inputVolume,
<a name="l00169"></a>00169                  <span class="keywordtype">float</span> *playbackVolume);
<a name="l00176"></a>00176    <span class="keywordtype">bool</span> InputMixerWorks();
<a name="l00181"></a>00181    wxArrayString GetInputSourceNames();
<a name="l00182"></a>00182 
<a name="l00191"></a>00191    <span class="keywordtype">void</span> HandleDeviceChange();
<a name="l00192"></a>00192 
<a name="l00195"></a>00195    <span class="keywordtype">void</span> SetMeters(<a class="code" href="class_meter.html" title="VU Meter, for displaying recording/playback level.">Meter</a> *inputMeter, <a class="code" href="class_meter.html" title="VU Meter, for displaying recording/playback level.">Meter</a> *outputMeter);
<a name="l00196"></a>00196    
<a name="l00209"></a>00209    <span class="keyword">static</span> wxArrayLong GetSupportedPlaybackRates(<span class="keywordtype">int</span> DevIndex = -1,
<a name="l00210"></a>00210                                                 <span class="keywordtype">double</span> rate = 0.0);
<a name="l00211"></a>00211 
<a name="l00224"></a>00224    <span class="keyword">static</span> wxArrayLong GetSupportedCaptureRates(<span class="keywordtype">int</span> devIndex = -1,
<a name="l00225"></a>00225                                                <span class="keywordtype">double</span> rate = 0.0);
<a name="l00226"></a>00226 
<a name="l00241"></a>00241    <span class="keyword">static</span> wxArrayLong GetSupportedSampleRates(<span class="keywordtype">int</span> playDevice = -1,
<a name="l00242"></a>00242                                               <span class="keywordtype">int</span> recDevice = -1,
<a name="l00243"></a>00243                                        <span class="keywordtype">double</span> rate = 0.0);
<a name="l00244"></a>00244 
<a name="l00253"></a>00253    <span class="keyword">static</span> <span class="keywordtype">int</span> GetOptimalSupportedSampleRate();
<a name="l00254"></a>00254 
<a name="l00262"></a>00262    <span class="keywordtype">double</span> GetStreamTime();
<a name="l00263"></a>00263 
<a name="l00264"></a><a class="code" href="class_audio_i_o.html#5735d00a230e2a59a9702dfbf1a8b85d">00264</a>    <a class="code" href="_sample_format_8h.html#9938d2e2f6adef23e745cd80ef379792">sampleFormat</a> <a class="code" href="class_audio_i_o.html#5735d00a230e2a59a9702dfbf1a8b85d">GetCaptureFormat</a>() { <span class="keywordflow">return</span> mCaptureFormat; }
<a name="l00265"></a><a class="code" href="class_audio_i_o.html#841f37644672ecb5ea445bfb52907c1f">00265</a>    <span class="keywordtype">int</span> <a class="code" href="class_audio_i_o.html#841f37644672ecb5ea445bfb52907c1f">GetNumCaptureChannels</a>() { <span class="keywordflow">return</span> mNumCaptureChannels; }
<a name="l00266"></a>00266 
<a name="l00271"></a><a class="code" href="class_audio_i_o.html#42f4cf4090548388aa1c762bb59778ba">00271</a>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> StandardRates[];
<a name="l00273"></a><a class="code" href="class_audio_i_o.html#4d794f0244d6be2f833a6627cbfcdae8">00273</a>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> NumStandardRates;
<a name="l00274"></a>00274 
<a name="l00278"></a>00278    wxString GetDeviceInfo();
<a name="l00279"></a>00279 
<a name="l00283"></a>00283    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="_audio_i_o_8h.html#52869f87b7f433c8848a4f2e90f31dfc">ValidateDeviceNames</a>(wxString play, wxString rec);
<a name="l00284"></a>00284 
<a name="l00288"></a>00288 <span class="preprocessor">   #ifdef AUTOMATED_INPUT_LEVEL_ADJUSTMENT</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span>      <span class="keywordtype">void</span> AILAInitialize();
<a name="l00290"></a>00290       <span class="keywordtype">void</span> AILADisable();
<a name="l00291"></a>00291       <span class="keywordtype">bool</span> AILAIsActive();
<a name="l00292"></a>00292       <span class="keywordtype">void</span> AILAProcess(<span class="keywordtype">double</span> maxPeak);
<a name="l00293"></a>00293       <span class="keywordtype">void</span> AILASetStartTime();
<a name="l00294"></a>00294       <span class="keywordtype">double</span> AILAGetLastDecisionTime();
<a name="l00295"></a>00295 <span class="preprocessor">   #endif</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>
<a name="l00297"></a>00297 <span class="keyword">private</span>:
<a name="l00308"></a>00308    <span class="keywordtype">double</span> GetBestRate(<span class="keywordtype">bool</span> capturing, <span class="keywordtype">bool</span> playing, <span class="keywordtype">double</span> sampleRate);
<a name="l00309"></a>00309 
<a name="l00320"></a>00320    <span class="keywordtype">bool</span> StartPortAudioStream(<span class="keywordtype">double</span> sampleRate,
<a name="l00321"></a>00321                              <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numPlaybackChannels,
<a name="l00322"></a>00322                              <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numCaptureChannels,
<a name="l00323"></a>00323                              <a class="code" href="_sample_format_8h.html#9938d2e2f6adef23e745cd80ef379792">sampleFormat</a> captureFormat);
<a name="l00324"></a>00324    <span class="keywordtype">void</span> FillBuffers();
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 <span class="preprocessor">#ifdef EXPERIMENTAL_MIDI_OUT</span>
<a name="l00327"></a>00327 <span class="preprocessor"></span>   <span class="keywordtype">bool</span> StartPortMidiStream();
<a name="l00328"></a>00328    <span class="keywordtype">void</span> OutputEvent();
<a name="l00329"></a>00329    <span class="keywordtype">void</span> FillMidiBuffers();
<a name="l00330"></a>00330    <span class="keywordtype">void</span> GetNextEvent();
<a name="l00331"></a>00331    <span class="keywordtype">void</span> AudacityMidiCallback();
<a name="l00332"></a>00332    <span class="keywordtype">double</span> getCurrentTrackTime();
<a name="l00333"></a>00333    <span class="keywordtype">long</span> calculateMidiTimeStamp(<span class="keywordtype">double</span> time);
<a name="l00334"></a>00334 <span class="preprocessor">#endif</span>
<a name="l00335"></a>00335 <span class="preprocessor"></span>
<a name="l00341"></a>00341    <span class="keywordtype">int</span> GetCommonlyAvailPlayback();
<a name="l00342"></a>00342 
<a name="l00349"></a>00349    <span class="keywordtype">int</span> GetCommonlyAvailCapture();
<a name="l00350"></a>00350 
<a name="l00358"></a>00358    <span class="keyword">static</span> <span class="keywordtype">int</span> getRecordDevIndex(wxString devName = wxT(<span class="stringliteral">""</span>));
<a name="l00359"></a>00359 
<a name="l00367"></a>00367    <span class="keyword">static</span> <span class="keywordtype">int</span> getPlayDevIndex(wxString devName = wxT(<span class="stringliteral">""</span>));
<a name="l00368"></a>00368 
<a name="l00373"></a><a class="code" href="class_audio_i_o.html#7a6449b2517e01d9d71a7cd69a11f851">00373</a>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> RatesToTry[];
<a name="l00375"></a><a class="code" href="class_audio_i_o.html#cd857695ae99aee7817a5d3db4c271c7">00375</a>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> NumRatesToTry;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377    <span class="keywordtype">double</span> NormalizeStreamTime(<span class="keywordtype">double</span> absoluteTime) <span class="keyword">const</span>;
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 <span class="preprocessor">#ifdef EXPERIMENTAL_MIDI_OUT</span>
<a name="l00380"></a>00380 <span class="preprocessor"></span>   <span class="comment">//   MIDI_PLAYBACK:</span>
<a name="l00381"></a>00381    PmStream           *mMidiStream;
<a name="l00382"></a>00382    <span class="comment">//   PmEvent             mMidiBuffer[MAX_MIDI_BUFFER_SIZE];</span>
<a name="l00383"></a>00383    <span class="comment">//   PmEvent             mMidiQueue[MAX_MIDI_BUFFER_SIZE];</span>
<a name="l00384"></a>00384    PmError             mLastPmError;
<a name="l00385"></a>00385    <span class="keywordtype">long</span>                mCurrentMidiTime;
<a name="l00386"></a>00386    <span class="keywordtype">long</span>                mMidiLatency; <span class="comment">// latency value for PortMidi</span>
<a name="l00387"></a>00387    <span class="keywordtype">long</span>                mLastMidiTime; <span class="comment">// timestamp of last midi message</span>
<a name="l00388"></a>00388    <span class="keywordtype">double</span>              mLastSystemTime; <span class="comment">// last system time received</span>
<a name="l00389"></a>00389    <span class="keywordtype">double</span>              mLatencyBetweenSystemTimes;
<a name="l00390"></a>00390    <span class="keywordtype">long</span>                mStartFrame;
<a name="l00391"></a>00391    <span class="keywordtype">long</span>                mNumPauseFrames;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393    <span class="comment">// TODO: Finish implementation of RequestMidiStop</span>
<a name="l00394"></a>00394    <span class="keywordtype">bool</span>                mRequestMidiStop;
<a name="l00395"></a>00395 
<a name="l00396"></a>00396    <span class="comment">// These two fields are used to synchronize MIDI with audio</span>
<a name="l00397"></a>00397    <span class="comment">// TODO: Finish implementing these fields</span>
<a name="l00398"></a>00398    <span class="keywordtype">double</span>              mAudioCallbackOutputTime;
<a name="l00399"></a>00399    <span class="keywordtype">long</span>                mAudioCallbackSampleNumber;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401    Alg_seq_ptr         mSeq;
<a name="l00402"></a>00402    Alg_iterator_ptr    mIterator;
<a name="l00403"></a>00403    Alg_event_ptr       mNextEvent; <span class="comment">// the next event to play (or null)</span>
<a name="l00404"></a>00404    <span class="keywordtype">double</span>              mNextEventTime; <span class="comment">// the time of the next event</span>
<a name="l00405"></a>00405                        <span class="comment">// (note that this could be a note's time+duration)</span>
<a name="l00406"></a>00406    <span class="keywordtype">bool</span>                mNextIsNoteOn; <span class="comment">// is the next event a note-off?</span>
<a name="l00407"></a>00407    <span class="keywordtype">int</span>                 mVC;   <span class="comment">// Visible Channel mask</span>
<a name="l00408"></a>00408    <span class="comment">//   int                 mCnt;</span>
<a name="l00409"></a>00409    <span class="keywordtype">long</span>                mMidiWait;
<a name="l00410"></a>00410    <span class="keywordtype">bool</span>                mMidiStreamActive;
<a name="l00411"></a>00411    <span class="comment">// when true, mSendMidiState means send only updates, not note-on's,</span>
<a name="l00412"></a>00412    <span class="comment">// used to send state changes that precede the selected notes</span>
<a name="l00413"></a>00413    <span class="keywordtype">bool</span>                mSendMidiState;
<a name="l00414"></a>00414    NoteTrackArray      *mMidiPlaybackTracks;
<a name="l00415"></a>00415    <span class="comment">//   NoteTrackArray      mMidiCaptureTracks;</span>
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="preprocessor">#endif</span>
<a name="l00418"></a>00418 <span class="preprocessor"></span>
<a name="l00419"></a>00419 <span class="preprocessor">#ifdef AUTOMATED_INPUT_LEVEL_ADJUSTMENT</span>
<a name="l00420"></a>00420 <span class="preprocessor"></span>   <span class="keywordtype">bool</span>           mAILAActive;
<a name="l00421"></a>00421    <span class="keywordtype">bool</span>           mAILAClipped;
<a name="l00422"></a>00422    <span class="keywordtype">int</span>            mAILATotalAnalysis;
<a name="l00423"></a>00423    <span class="keywordtype">int</span>            mAILAAnalysisCounter;
<a name="l00424"></a>00424    <span class="keywordtype">double</span>         mAILAMax;
<a name="l00425"></a>00425    <span class="keywordtype">double</span>         mAILAGoalPoint;
<a name="l00426"></a>00426    <span class="keywordtype">double</span>         mAILAGoalDelta;
<a name="l00427"></a>00427    <span class="keywordtype">double</span>         mAILAAnalysisTime;
<a name="l00428"></a>00428    <span class="keywordtype">double</span>         mAILALastStartTime;
<a name="l00429"></a>00429    <span class="keywordtype">double</span>         mAILAChangeFactor;
<a name="l00430"></a>00430    <span class="keywordtype">double</span>         mAILATopLevel;
<a name="l00431"></a>00431    <span class="keywordtype">double</span>         mAILAAnalysisEndTime;
<a name="l00432"></a>00432    <span class="keywordtype">double</span>         mAILAAbsolutStartTime;
<a name="l00433"></a>00433    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> mAILALastChangeType;  <span class="comment">//0 - no change, 1 - increase change, 2 - decrease change</span>
<a name="l00434"></a>00434 <span class="preprocessor">#endif</span>
<a name="l00435"></a>00435 <span class="preprocessor"></span>
<a name="l00436"></a><a class="code" href="class_audio_i_o.html#be59a72ea00361a4ae9c027b7b86db55">00436</a>    <a class="code" href="class_audio_thread.html" title="Defined different on Mac and other platforms (on Mac it does not use wxWidgets wxThread)...">AudioThread</a>        *mThread;
<a name="l00437"></a><a class="code" href="class_audio_i_o.html#d1e8c444ca5eb006c2c885b9e61fbb2a">00437</a>    <a class="code" href="class_resample.html" title="Combined interface to libresample and libsamplerate.">Resample</a>          **mResample;
<a name="l00438"></a><a class="code" href="class_audio_i_o.html#9943bccca4dc39c7f8aeba2157920a96">00438</a>    <a class="code" href="class_ring_buffer.html" title="Holds streamed audio samples.">RingBuffer</a>        **mCaptureBuffers;
<a name="l00439"></a><a class="code" href="class_audio_i_o.html#f0971d8057b3bbe1557c1682e5a6abb6">00439</a>    WaveTrackArray      mCaptureTracks;
<a name="l00440"></a><a class="code" href="class_audio_i_o.html#2fc9ce02752e7f102c7952005ac0dfbe">00440</a>    <a class="code" href="class_ring_buffer.html" title="Holds streamed audio samples.">RingBuffer</a>        **mPlaybackBuffers;
<a name="l00441"></a><a class="code" href="class_audio_i_o.html#eb78aba80a54bfcff7024a8fa457c73a">00441</a>    WaveTrackArray      mPlaybackTracks;
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="class_audio_i_o.html#4cf441a40e28412dd800304fa748a39b">00443</a>    <a class="code" href="class_mixer.html" title="Functions for doing the mixdown of the tracks.">Mixer</a>             **mPlaybackMixers;
<a name="l00444"></a><a class="code" href="class_audio_i_o.html#5afe23647a00239b06f3931eac411b02">00444</a>    <span class="keywordtype">int</span>                 mStreamToken;
<a name="l00445"></a><a class="code" href="class_audio_i_o.html#38845eba480f9426556b8cd39b026515">00445</a>    <span class="keywordtype">int</span>                 mStopStreamCount;
<a name="l00446"></a><a class="code" href="class_audio_i_o.html#9ccf03b89e0cd5e6218550b4213a2401">00446</a>    <span class="keyword">static</span> <span class="keywordtype">int</span>          mNextStreamToken;
<a name="l00447"></a><a class="code" href="class_audio_i_o.html#fb2cd8cfdaff11b52c3e6b91f5bfb395">00447</a>    <span class="keywordtype">double</span>              mFactor;
<a name="l00448"></a><a class="code" href="class_audio_i_o.html#4c1d73ec8e53dc39f0552c69fbb58478">00448</a>    <span class="keywordtype">double</span>              mRate;
<a name="l00449"></a><a class="code" href="class_audio_i_o.html#45520c04e90d082ab2d1f9f1eab6fa92">00449</a>    <span class="keywordtype">double</span>              mT;
<a name="l00450"></a><a class="code" href="class_audio_i_o.html#e44e43a79e74f936873a1aa56f425d0d">00450</a>    <span class="keywordtype">double</span>              mT0; <span class="comment">// playback starts at offset of mT0</span>
<a name="l00451"></a><a class="code" href="class_audio_i_o.html#eaa6d968d53f7484758f2814cc39707b">00451</a>    <span class="keywordtype">double</span>              mT1; <span class="comment">// and ends at offset of mT1</span>
<a name="l00452"></a><a class="code" href="class_audio_i_o.html#df2d6f71c9cd21fd2064e38572714c99">00452</a>    <span class="keywordtype">double</span>              mTime; <span class="comment">// current time position during playback</span>
<a name="l00453"></a><a class="code" href="class_audio_i_o.html#b0682a09425b8a119725f9db01b2d3d2">00453</a>    <span class="keywordtype">double</span>              mWarpedT1;
<a name="l00454"></a><a class="code" href="class_audio_i_o.html#ff6b26b419fcb778d39873cd70334463">00454</a>    <span class="keywordtype">double</span>              mSeek;
<a name="l00455"></a><a class="code" href="class_audio_i_o.html#6381cb51853d6c61f1c438d66abce61a">00455</a>    <span class="keywordtype">double</span>              mPlaybackRingBufferSecs;
<a name="l00456"></a><a class="code" href="class_audio_i_o.html#be53e98a215869221222ad75d2d3ba4a">00456</a>    <span class="keywordtype">double</span>              mCaptureRingBufferSecs;
<a name="l00457"></a><a class="code" href="class_audio_i_o.html#0412d78d824d14f9de1368578b517c92">00457</a>    <span class="keywordtype">double</span>              mMaxPlaybackSecsToCopy;
<a name="l00458"></a><a class="code" href="class_audio_i_o.html#c0e4f8186f0c7fd2d2be77995f3d4a94">00458</a>    <span class="keywordtype">double</span>              mMinCaptureSecsToCopy;
<a name="l00459"></a><a class="code" href="class_audio_i_o.html#138fbc3be7e9440a23c38497347e26c5">00459</a>    <span class="keywordtype">bool</span>                mPaused;
<a name="l00460"></a><a class="code" href="class_audio_i_o.html#49b21a3035e9556a54684bf6bc32356a">00460</a>    PaStream           *mPortStreamV19;
<a name="l00461"></a><a class="code" href="class_audio_i_o.html#406d8e0362d4f43c34dd817710247d63">00461</a>    <span class="keywordtype">bool</span>                mSoftwarePlaythrough;
<a name="l00462"></a><a class="code" href="class_audio_i_o.html#06462325e7e5409cb42f2c2675838aee">00462</a>    <span class="keywordtype">bool</span>                mPauseRec;
<a name="l00463"></a><a class="code" href="class_audio_i_o.html#c6361df44d71228f143778ecebebdb54">00463</a>    <span class="keywordtype">float</span>               mSilenceLevel;
<a name="l00464"></a><a class="code" href="class_audio_i_o.html#d8431949843083dcc6f069eebdcc2278">00464</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        mNumCaptureChannels;
<a name="l00465"></a><a class="code" href="class_audio_i_o.html#36c6f90a506763594c598f4e7af52723">00465</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        mNumPlaybackChannels;
<a name="l00466"></a><a class="code" href="class_audio_i_o.html#3ced3771559e0231c0dc521d4770922d">00466</a>    <a class="code" href="_sample_format_8h.html#9938d2e2f6adef23e745cd80ef379792">sampleFormat</a>        mCaptureFormat;
<a name="l00467"></a><a class="code" href="class_audio_i_o.html#000dad9d28f9d96130894f2a2e22e227">00467</a>    <span class="keywordtype">float</span>              *mTempFloats;
<a name="l00468"></a><a class="code" href="class_audio_i_o.html#17c3501d96e68b6f79f354bc0b0205a9">00468</a>    <span class="keywordtype">int</span>                 mLostSamples;
<a name="l00469"></a><a class="code" href="class_audio_i_o.html#c46dc8c642a3d340a0685e3cf69a8885">00469</a>    <span class="keyword">volatile</span> <span class="keywordtype">bool</span>       mAudioThreadShouldCallFillBuffersOnce;
<a name="l00470"></a><a class="code" href="class_audio_i_o.html#38da766dd2ae4aee4ec2121d3a97003d">00470</a>    <span class="keyword">volatile</span> <span class="keywordtype">bool</span>       mAudioThreadFillBuffersLoopRunning;
<a name="l00471"></a><a class="code" href="class_audio_i_o.html#5b5caa76e3cd101bc3631bcbcd498f22">00471</a>    <span class="keyword">volatile</span> <span class="keywordtype">bool</span>       mAudioThreadFillBuffersLoopActive;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473 <span class="comment">/* REQUIRES PORTMIDI */</span>
<a name="l00474"></a>00474 <span class="comment">//   volatile bool       mMidiThreadShouldCallFillBuffersOnce;</span>
<a name="l00475"></a>00475 <span class="comment">//   volatile bool       mMidiThreadFillBuffersLoopRunning;</span>
<a name="l00476"></a>00476 <span class="comment">//   volatile bool       mMidiThreadFillBuffersLoopActive;</span>
<a name="l00477"></a>00477 
<a name="l00478"></a><a class="code" href="class_audio_i_o.html#880f41d8318c700e3d6bbad4aafa64b4">00478</a>    <span class="keyword">volatile</span> <span class="keywordtype">double</span>     mLastRecordingOffset;
<a name="l00479"></a><a class="code" href="class_audio_i_o.html#a029876175fac5537354387b6f8f0081">00479</a>    PaError             mLastPaError;
<a name="l00480"></a>00480 
<a name="l00481"></a><a class="code" href="class_audio_i_o.html#460f5fb4800a06db7aba2f9682b2fb9f">00481</a>    <a class="code" href="class_meter.html" title="VU Meter, for displaying recording/playback level.">Meter</a>              *mInputMeter;
<a name="l00482"></a><a class="code" href="class_audio_i_o.html#b00f0faccf7e59dce5432e36c05f243a">00482</a>    <a class="code" href="class_meter.html" title="VU Meter, for displaying recording/playback level.">Meter</a>              *mOutputMeter;
<a name="l00483"></a><a class="code" href="class_audio_i_o.html#755844de58787c4ebe165e3344595de9">00483</a>    <span class="keywordtype">bool</span>                mUpdateMeters;
<a name="l00484"></a><a class="code" href="class_audio_i_o.html#669282232e6710ba7b9985932012e85b">00484</a>    <span class="keywordtype">bool</span>                mUpdatingMeters;
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 <span class="preprocessor">   #if USE_PORTMIXER</span>
<a name="l00487"></a>00487 <span class="preprocessor"></span>   PxMixer            *mPortMixer;
<a name="l00488"></a>00488    <span class="keywordtype">float</span>               mPreviousHWPlaythrough;
<a name="l00489"></a>00489 <span class="preprocessor">   #endif </span><span class="comment">/* USE_PORTMIXER */</span>
<a name="l00490"></a>00490 
<a name="l00491"></a><a class="code" href="class_audio_i_o.html#48dbb8470710384234e15d0839cebcfa">00491</a>    <span class="keywordtype">bool</span>                mEmulateMixerOutputVol;
<a name="l00499"></a><a class="code" href="class_audio_i_o.html#f535797f7ac020e1811cc38bfba66e17">00499</a>    <span class="keywordtype">bool</span>                mInputMixerWorks;
<a name="l00500"></a><a class="code" href="class_audio_i_o.html#9027df822d0f1ebd27de7b36dbbc6e1e">00500</a>    <span class="keywordtype">float</span>               mMixerOutputVol;
<a name="l00501"></a>00501 
<a name="l00502"></a><a class="code" href="class_audio_i_o.html#55d433b7ea62f9dac63eea89b90de186">00502</a>    <span class="keywordtype">bool</span>                mPlayLooped;
<a name="l00503"></a><a class="code" href="class_audio_i_o.html#592b2c6f26e92558bb3143a086cc267e">00503</a>    <span class="keywordtype">double</span>              mCutPreviewGapStart;
<a name="l00504"></a><a class="code" href="class_audio_i_o.html#cbaec684c745f9ada543bdcd80ea389d">00504</a>    <span class="keywordtype">double</span>              mCutPreviewGapLen;
<a name="l00505"></a>00505    
<a name="l00506"></a><a class="code" href="class_audio_i_o.html#1f2981589630229271d619d07af50d01">00506</a>    <a class="code" href="_sample_format_8h.html#aafb46d1caf7c79262fec96b577215fe">samplePtr</a> mSilentBuf;
<a name="l00507"></a><a class="code" href="class_audio_i_o.html#74cad4d9b327daf8307d146985197850">00507</a>    <a class="code" href="_sequence_8h.html#c464776e216051832ee476fb45c7fedd">sampleCount</a> mLastSilentBufSize;
<a name="l00508"></a>00508    
<a name="l00509"></a><a class="code" href="class_audio_i_o.html#5ea088c672f9438827a842fb45aa04f8">00509</a>    <a class="code" href="class_audio_i_o_listener.html">AudioIOListener</a>*    mListener;
<a name="l00510"></a>00510 
<a name="l00511"></a><a class="code" href="class_audio_i_o.html#894b7c943c91bb34f845aeb117786dff">00511</a>    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="class_audio_thread.html" title="Defined different on Mac and other platforms (on Mac it does not use wxWidgets wxThread)...">AudioThread</a>;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513    <span class="keyword">friend</span> <span class="keywordtype">void</span> <a class="code" href="_audio_i_o_8cpp.html#5c082d9ef3612f42a4a78edffdf2a0db">InitAudioIO</a>();
<a name="l00514"></a>00514    <span class="keyword">friend</span> <span class="keywordtype">void</span> <a class="code" href="_audio_i_o_8cpp.html#362633315924afe19ab0fe0cf4bd32da">DeinitAudioIO</a>();
<a name="l00515"></a>00515 
<a name="l00516"></a><a class="code" href="class_audio_i_o.html#2242677985647e79554f7ce564dd196d">00516</a>    <a class="code" href="class_time_track.html" title="A kind of Track used to &amp;#39;warp time&amp;#39;.">TimeTrack</a> *mTimeTrack;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518    <span class="comment">// For cacheing supported sample rates</span>
<a name="l00519"></a><a class="code" href="class_audio_i_o.html#d99844c4c1facce701712ae6750b015f">00519</a>    <span class="keyword">static</span> <span class="keywordtype">int</span> mCachedPlaybackIndex;
<a name="l00520"></a><a class="code" href="class_audio_i_o.html#a66d101f7f1517437f94f25d19917f86">00520</a>    <span class="keyword">static</span> wxArrayLong mCachedPlaybackRates;
<a name="l00521"></a><a class="code" href="class_audio_i_o.html#e00831ed842c9eb0c5cb423c23d920be">00521</a>    <span class="keyword">static</span> <span class="keywordtype">int</span> mCachedCaptureIndex;
<a name="l00522"></a><a class="code" href="class_audio_i_o.html#8b1ec1271604968c425545fafc4501e9">00522</a>    <span class="keyword">static</span> wxArrayLong mCachedCaptureRates;
<a name="l00523"></a><a class="code" href="class_audio_i_o.html#8ef848736a948b39ecb0c6dca08cc568">00523</a>    <span class="keyword">static</span> wxArrayLong mCachedSampleRates;
<a name="l00524"></a><a class="code" href="class_audio_i_o.html#a93703171e76dddb0908af3a428ddc90">00524</a>    <span class="keyword">static</span> <span class="keywordtype">double</span> mCachedBestRateIn;
<a name="l00525"></a><a class="code" href="class_audio_i_o.html#9c35f06f25392535e3214c1a11d0c5a0">00525</a>    <span class="keyword">static</span> <span class="keywordtype">double</span> mCachedBestRateOut;
<a name="l00526"></a>00526 
<a name="l00549"></a>00549    <span class="keyword">friend</span> <span class="keywordtype">int</span> <a class="code" href="_audio_i_o_8cpp.html#0d694f00df707ad21d421a1b29ad46ea">audacityAudioCallback</a>(
<a name="l00550"></a>00550                 <span class="keyword">const</span> <span class="keywordtype">void</span> *inputBuffer, <span class="keywordtype">void</span> *outputBuffer,
<a name="l00551"></a>00551                 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> framesPerBuffer,
<a name="l00552"></a>00552                 <span class="keyword">const</span> PaStreamCallbackTimeInfo *timeInfo,
<a name="l00553"></a>00553                 PaStreamCallbackFlags statusFlags, <span class="keywordtype">void</span> *userData );
<a name="l00554"></a>00554 };
<a name="l00555"></a>00555 
<a name="l00556"></a>00556 <span class="preprocessor">#endif</span>
<a name="l00557"></a>00557 <span class="preprocessor"></span>
<a name="l00558"></a>00558 <span class="comment">// Indentation settings for Vim and Emacs and unique identifier for Arch, a</span>
<a name="l00559"></a>00559 <span class="comment">// version control system. Please do not modify past this point.</span>
<a name="l00560"></a>00560 <span class="comment">//</span>
<a name="l00561"></a>00561 <span class="comment">// Local Variables:</span>
<a name="l00562"></a>00562 <span class="comment">// c-basic-offset: 3</span>
<a name="l00563"></a>00563 <span class="comment">// indent-tabs-mode: nil</span>
<a name="l00564"></a>00564 <span class="comment">// End:</span>
<a name="l00565"></a>00565 <span class="comment">//</span>
<a name="l00566"></a>00566 <span class="comment">// vim: et sts=3 sw=3</span>
<a name="l00567"></a>00567 <span class="comment">// arch-tag: 5b5316f5-6078-469b-950c-9da893cd62c9</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Feb 20 20:49:13 2010 for Audacity by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
