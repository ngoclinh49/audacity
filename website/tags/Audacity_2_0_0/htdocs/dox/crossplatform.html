<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Audacity: Cross Platform Coding Tips</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="CrossPlatform">Cross Platform Coding Tips </a></h1><p>Guidelines for making the code compile and work on all supported platforms.</p>
<h2><a class="anchor" id="PragmaOnce">
#pragma once</a></h2>
<p>The following is not supported under gcc 2.x:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// WRONG</span>
<span class="preprocessor">#pragma once</span>
</pre></div><p>Instead use the traditional:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#ifndef __AUDACITY_HEADER_FILE_NAME__</span>
<span class="preprocessor"></span><span class="preprocessor">#define __AUDACITY_HEADER_FILE_NAME__</span>
<span class="preprocessor"></span>
<span class="comment">// your header file contents goes here.</span>

<span class="preprocessor">#endif</span>
</pre></div><h2><a class="anchor" id="UnicodeStrings">
Unicode strings</a></h2>
<p>Audacity code is translated, and it may be built in Unicode versions. For this reason all strings should be wrapped like this:</p>
<div class="fragment"><pre class="fragment">   <span class="comment">// for strings which are not translated</span>
   mMyFirstString = wxT(<span class="stringliteral">&quot;some untranslated string&quot;</span>);
   <span class="comment">// for strings which should be translated</span>
   mMySecondString = _(<span class="stringliteral">&quot;some translatable string&quot;</span>);
</pre></div><p>In some cases you need to give hints to a translator about how a string should be translated. Do so as follows:</p>
<p><div class="fragment"><pre class="fragment">   <span class="comment">/* i18n-hint: One-letter abbreviation for Left, in VU Meter */</span>
   mLeftText = _(<span class="stringliteral">&quot;L&quot;</span>);
   <span class="comment">/* i18n-hint: One-letter abbreviation for Right, in VU Meter */</span>
   mRightText = _(<span class="stringliteral">&quot;R&quot;</span>);
</pre></div></p>
<p>Very long strings can be wrapped across multiple lines, as follows:</p>
<div class="fragment"><pre class="fragment">   <span class="comment">// For untranslated strings:</span>
   wxT(<span class="stringliteral">&quot;This is a long untranslated string &quot;</span>)
   wxT(&quot;which spans several lines &quot;)
   wxT(&quot;and works in Unicode builds too&quot;)

   <span class="comment">// For translated strings:</span>
   _(&quot;This is a <span class="keywordtype">long</span> translated <span class="keywordtype">string</span> &quot;
   wxT(&quot;which spans several lines &quot;)
   wxT(&quot;and works in Unicode builds too&quot;))
</pre></div><p>Notice that in the translated example, all bar the first substring are contained within a <code>wxT()</code>.</p>
<h2><a class="anchor" id="ConstructorsAsArguments">
Constructors as Arguments</a></h2>
<p>Don't write code like this:</p>
<div class="fragment"><pre class="fragment">   <span class="comment">// WRONG</span>
   <span class="comment">// Now call OnSampleRateChange to update the values.</span>
   OnSampleRateChange( wxCommandEvent() );
</pre></div><p>Whilst it is fine under MSVC it will cause a problem under gcc as the constructor is a temporary object which will be optimised away.</p>
<p>Instead use:</p>
<div class="fragment"><pre class="fragment">   <span class="comment">// Now call OnSampleRateChange to update the values.</span>
   wxCommandEvent e;
   OnSampleRateChange( e );
</pre></div><h2><a class="anchor" id="HeaderFiles">
Header Files</a></h2>
<p>Windows systems are not case sensitive, whilst Linux systems are. You therefore need to take care in capitalisation, e.g:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;<a class="code" href="_attachable_scroll_bar_8h.html">AttachableScrollBar.h</a>&quot;</span>
</pre></div><h2><a class="anchor" id="ClassNamesInClasses">
Class Names in Classes</a></h2>
<p>Microsoft Visual C++ allows you to write code like this in a header file:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// WRONG</span>
<span class="keyword">class </span>MyClass 
{
<span class="keyword">public</span>:
   <span class="keywordtype">int</span> MyClass::SomeFunction();
   <span class="comment">//... other stuff</span>
</pre></div><p>For portability, the <code>'MyClass</code>::' prefix should be left out.</p>
<h2><a class="anchor" id="wxStringInFormat">
Using wxString in Format</a></h2>
<p>Don't write code like this:</p>
<div class="fragment"><pre class="fragment">   wxString Message( wxT(<span class="stringliteral">&quot;Hello&quot;</span> )); 
   <span class="comment">// WRONG</span>
   wxString Temp = wxString::Format(wxT(<span class="stringliteral">&quot;Your said %s in your message&quot;</span>), Message );
</pre></div><p>Although MSVC won't complain even in Unicode mode, it generates a warning under gcc. Instead you need:</p>
<div class="fragment"><pre class="fragment">   wxString Message( wxT(<span class="stringliteral">&quot;Hello&quot;</span> )); 
   wxString Temp = wxString::Format(wxT(<span class="stringliteral">&quot;Your said %s in your message&quot;</span>), Message.c_str() );
</pre></div><h2><a class="anchor" id="ForwardEnums">
Forward Declared Enums</a></h2>
<p>Microsoft Visual C++ allows you to write code like this in a header file:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// WRONG</span>
<span class="keyword">enum</span> MyEnum;
</pre></div><p>That is, you can forward declare an enum just as you can forward declare a class. This is not portable. The alternative is to include a header file containing the full enum definition.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;MyEnum.h&quot;</span>
</pre></div> </div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Sat Mar 6 23:01:10 2010 for Audacity by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
